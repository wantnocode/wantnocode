"use strict";var myWholeModel;function f_v_layout(){myDiagram.div=null,myDiagram=GO(go.Diagram,Diagram_name,{contentAlignment:go.Spot.Center,initialAutoScale:go.Diagram.Uniform,layout:GO(VirtualizedForceDirectedLayout,{defaultSpringLength:50,maxIterations:300}),"undoManager.isEnabled":!0,"animationManager.isEnabled":!1}),initOverview(),myDiagram.nodeTemplateMap.add("",GO(go.Node,"Vertical",{isLayoutPositioned:!1},new go.Binding("position","bounds",function(e){return e.position}).makeTwoWay(function(e,n){return new go.Rect(e.x,e.y,n.bounds.width,n.bounds.height)}),{zOrder:2,layerName:"Foreground",click:function(){},doubleClick:function(){send_newGraph("属性")}},new go.Binding("visible"),GO(go.Shape,"Ellipse",{name:"node_shape",stroke:"#fff",fill:"#006ADF",width:60,cursor:"pointer",height:60,portId:"",strokeWidth:5},{toolTip:tooltipTemplate},new go.Binding("fill","d_fill",function(e){return""==e?go.Brush.randomColor():e}),new go.Binding("stroke","d_stroke"),new go.Binding("width"),new go.Binding("height")),GO(go.Picture,{name:"node_",source:"./img/account.svg",margin:new go.Margin(-40,0,0,0),visible:!1},new go.Binding("source","icon",geoFunc),new go.Binding("width","width",function(e){return.6*e}),new go.Binding("height","height",function(e){return.5*e}),new go.Binding("margin","height",function(e){return new go.Margin(.78*-e,0,0,0)})),GO(go.Panel,"Auto",{name:"node_text",margin:12,visible:!1},new go.Binding("margin","width",function(e){return 12*e/60*1.2}),GO(go.Shape,"Rectangle",{fill:null,stroke:null,margin:new go.Margin(5,0,0,0)},new go.Binding("fill","isSelected",function(e){return e?"#FFC106":null}).ofObject("")),GO(go.TextBlock,{margin:6,font:"14px helvetica, bold Arial, sans-serif"},new go.Binding("text","text",function(e){return e}),new go.Binding("font","font_size",function(e){return e+"px helvetica, bold Arial, sans-serif"}),new go.Binding("stroke","isSelected",function(e){return e?"#fff":"#333"}).ofObject(""))),{selectionAdornmentTemplate:GO(go.Adornment,"Vertical",GO(go.Shape,"RoundedRectangle",{width:100,height:130,fill:null,stroke:null,strokeWidth:5,margin:new go.Margin(0,0,0,0)}),GO(go.Placeholder))},{selectionAdorned:!1})),myDiagram.linkTemplate=GO(go.Link,{cursor:"pointer",zOrder:1,isLayoutPositioned:!1},{doubleClick:function(){send_newGraph("属性")}},{toolTip:tooltipTemplate_link},GO(go.Shape,{name:"link_arrow",toArrow:"standard",stroke:"#BDBDBD",fill:"#BDBDBD",visible:!0},new go.Binding("fill","d_stroke",function(e){return e}),new go.Binding("strokeWidth","width"),new go.Binding("stroke","d_stroke",function(e){return e}),new go.Binding("visible","direction",function(e){return 0!==e&&(1===e||2!==e&&(3===e||void 0))})),GO(go.Shape,{name:"link_arrow",fromArrow:"Backward",stroke:"#BDBDBD",fill:"#BDBDBD",visible:!0},new go.Binding("fill","d_stroke",function(e){return e}),new go.Binding("stroke","d_stroke",function(e){return e}),new go.Binding("strokeWidth","width"),new go.Binding("visible","direction",function(e){return 0!==e&&(1!==e&&(2===e||(3===e||void 0)))})),GO(go.Shape,{name:"edge_shape",opacity:1,isPanelMain:!0,stroke:"#BDBDBD",strokeWidth:1,fill:"#BDBDBD"},new go.Binding("fill","d_stroke",function(e){return e}),new go.Binding("stroke","d_stroke",function(e){return e}),new go.Binding("strokeWidth","stroke_width")),{},GO(go.TextBlock,{name:"link_text",text:"",textAlign:"center",font:"12px helvetica, bold Arial, sans-serif",stroke:"#333",editable:!1,opacity:1,segmentOffset:new go.Point(10,NaN),segmentOrientation:go.Link.OrientUpleft,margin:4},new go.Binding("text"),new go.Binding("font","font",function(e){return e+"px helvetica, bold Arial, sans-serif"}))),myWholeModel=GO(go.GraphLinksModel),myDiagram.layout.model=myWholeModel,myDiagram.model=GO(go.GraphLinksModel),myDiagram.isVirtualized=!0,myDiagram.addDiagramListener("ViewportBoundsChanged",onViewportChanged),myDiagram.addDiagramListener("InitialLayoutCompleted",function(e){$(".loading").hide(),$(".loading_box").hide(),$(".entity_toast").css("left",document.body.clientWidth/2-100),$(".entity_toast").css("top",300),$(".entity_toast").text("布局完成"),$(".entity_toast").show(),setTimeout(function(){$(".entity_toast").hide()},500);var n=myWholeModel.findNodeDataForKey(0);null!==n&&myDiagram.centerRect(n.bounds)}),myDiagram.addDiagramListener("ChangedSelection",function(e){ChangedSelection_fuc()})}function computeDocumentBounds(e){for(var n=new go.Rect,t=e.nodeDataArray,o=0;o<t.length;o++){var i=t[o];i.bounds&&(0===o?n.set(i.bounds):n.unionRect(i.bounds))}return n}function onViewportChanged(e){myDiagram.scale<=4?sets_sale_num(myDiagram.scale):myDiagram.scale=4,1==rendering_type&&setBottom_nav(nodeArray.length,graph_tool.nodesSelectCount(),graph_tool.nodesVisibleCount(),linkArray.length,graph_tool.edgesSelectCount(),graph_tool.edgesVisibleCount());var t=myDiagram.scale;myDiagram.nodes.each(function(e){var n=e.findObject("node_"),e=e.findObject("node_text");null!==n&&(n.visible=!(t<.8)),null!==e&&(e.visible=!(t<.8))}),myDiagram.links.each(function(e){var n=e.findObject("link_text"),e=e.findObject("link_");null!==n&&(n.visible=!(t<.8)),null!==e&&(e.visible=!(t<.8))});var n=e.diagram,o=n.viewportBounds,i=n.model,e=n.skipsUndoManager;n.skipsUndoManager=!0;for(var r=new go.Rect,a=myWholeModel.nodeDataArray,d=0;d<a.length;d++){var l=a[d];if(l.bounds){l.bounds.intersectsRect(o)&&i.addNodeData(l);for(var g=myWholeModel.linkDataArray,d=0;d<g.length;d++){var s,u=g[d],c=myWholeModel.getFromKeyForLinkData(u);void 0!==c&&(null!==(s=myWholeModel.findNodeDataForKey(c))&&s.bounds&&(void 0===(c=myWholeModel.getToKeyForLinkData(u))||null!==(c=myWholeModel.findNodeDataForKey(c))&&c.bounds&&(r.set(s.bounds),r.unionRect(c.bounds),r.intersectsRect(o)&&(i.addNodeData(s),i.addNodeData(c),i.addLinkData(u),null!==(u=n.findLinkForData(u))&&(u.fromNode.ensureBounds(),u.toNode.ensureBounds(),u.updateRoute())))))}}}n.skipsUndoManager=e,null===myRemoveTimer&&(myRemoveTimer=setTimeout(function(){removeOffscreen(n)},3e3))}var myRemoveTimer=null;function removeOffscreen(e){myRemoveTimer=null;for(var n,t=e.viewportBounds,o=e.model,i=[],r=new go.Set,a=e.nodes;a.next();){var d=a.value,l=d.data;null!==l&&(d.actualBounds.intersectsRect(t)||d.isSelected||d.linksConnected.any(function(e){return e.actualBounds.intersectsRect(t)})||(i.push(l),o instanceof go.GraphLinksModel&&r.addAll(d.linksConnected)))}0<i.length&&(n=e.skipsUndoManager,e.skipsUndoManager=!0,o.removeNodeDataCollection(i),o instanceof go.GraphLinksModel&&r.each(function(e){e.isSelected||o.removeLinkData(e.data)}),e.skipsUndoManager=n)}function VirtualizedForceDirectedLayout(){go.ForceDirectedLayout.call(this),this.isOngoing=!1,this.model=null}function VirtualizedForceDirectedNetwork(e){go.ForceDirectedNetwork.call(this,e)}go.Diagram.inherit(VirtualizedForceDirectedLayout,go.ForceDirectedLayout),VirtualizedForceDirectedLayout.prototype.createNetwork=function(){return new VirtualizedForceDirectedNetwork(this)},VirtualizedForceDirectedLayout.prototype.makeNetwork=function(e){var n=this.createNetwork();return n.addData(this.model),n},VirtualizedForceDirectedLayout.prototype.commitLayout=function(){go.ForceDirectedLayout.prototype.commitLayout.call(this),this.diagram.fixedBounds=computeDocumentBounds(this.model),this.diagram.nodes.each(function(e){e.updateTargetBindings()})},go.Diagram.inherit(VirtualizedForceDirectedNetwork,go.ForceDirectedNetwork),VirtualizedForceDirectedNetwork.prototype.addData=function(e){if(!(e instanceof go.GraphLinksModel))throw new Error("can only handle GraphLinksModel data");for(var n=new go.Map,t=e.nodeDataArray,o=0;o<t.length;o++){var i=t[o],r=this.createVertex();r.data=i,n.set(e.getKeyForNodeData(i),r),this.addVertex(r)}for(var a=e.linkDataArray,o=0;o<a.length;o++){var d,i=a[o],l=n.get(e.getFromKeyForLinkData(i)),g=n.get(e.getToKeyForLinkData(i));null!==l&&null!==g&&((d=this.createEdge()).data=i,d.fromVertex=l,d.toVertex=g,this.addEdge(d))}},VirtualizedForceDirectedNetwork.prototype.deleteArtificialVertexes=function(){};