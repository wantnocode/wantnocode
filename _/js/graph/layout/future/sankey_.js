"use strict";function SankeyLayout(){go.LayeredDigraphLayout.call(this)}function getAutoHeightForNode(e){for(var t=0,o=e.findLinksInto();o.next();)t+=o.value.computeThickness();for(var n=0,o=e.findLinksOutOf();o.next();)n+=o.value.computeThickness();e=Math.max(t,n);return e<10&&(e=10),e}go.Diagram.inherit(SankeyLayout,go.LayeredDigraphLayout),SankeyLayout.prototype.makeNetwork=function(e){var a=go.LayeredDigraphLayout.prototype.makeNetwork.call(this,e);return this.diagram.nodes.each(function(e){var t=getAutoHeightForNode(e),o=e.findObject("SHAPE");o&&(o.height=t);var n=e.findObject("TEXT"),o=e.findObject("LTEXT"),t="bold "+Math.max(12,Math.round(t/8))+"pt Segoe UI, sans-serif";n&&(n.font=t),o&&(o.font=t);t=a.findVertex(e);null!==t&&(e.ensureBounds(),e=e.actualBounds,t.width=e.width,t.height=e.height,t.focusY=t.height/2)}),a},SankeyLayout.prototype.nodeMinColumnSpace=function(e,t){if(null!==e.node)return go.LayeredDigraphLayout.prototype.nodeMinColumnSpace.call(this,e,t);if(1<=e.edgesCount){for(var o=1,n=e.edges;n.next();){var a=n.value;if(null!=a.link){a=a.link.computeThickness();o<a&&(o=a);break}}return Math.max(2,Math.ceil(o/this.columnSpacing))}return 2},SankeyLayout.prototype.nodeMinLayerSpace=function(e,t){return null===e.node?100:go.LayeredDigraphLayout.prototype.nodeMinLayerSpace.call(this,e,t)},SankeyLayout.prototype.assignLayers=function(){go.LayeredDigraphLayout.prototype.assignLayers.call(this);for(var e=this.maxLayer,t=this.network.vertexes.iterator;t.next();){var o=t.value;o.node;0==o.destinationVertexes.count&&(o.layer=0),0==o.sourceVertexes.count&&(o.layer=e)}},SankeyLayout.prototype.commitLayout=function(){go.LayeredDigraphLayout.prototype.commitLayout.call(this);for(var e=this.network.edges.iterator;e.next();){var t=e.value.link;t&&t.curve===go.Link.Bezier&&t.invalidateRoute()}};var animation=new go.Animation;function sankey_layout(){myDiagram.div=null,myDiagram=GO(go.Diagram,Diagram_name,{initialAutoScale:go.Diagram.Uniform,"animationManager.isEnabled":!1,layout:GO(SankeyLayout,{setsPortSpots:!1,direction:0,layeringOption:go.LayeredDigraphLayout.LayerOptimalLinkLength,packOption:go.LayeredDigraphLayout.PackStraighten||go.LayeredDigraphLayout.PackMedian,layerSpacing:100,columnSpacing:10})});myDiagram.nodeTemplate=GO(go.Node,{zOrder:2,locationObjectName:"SHAPE",locationSpot:go.Spot.Left,portSpreading:go.Node.SpreadingPacked},new go.Binding("location","loc",function(e,t){return 1==t.data.isLocking?(t.isLayoutPositioned=!1,t.part.movable=!1,new go.Point(t.data.lock.x,t.data.lock.y)):new go.Point.parse(e)}).makeTwoWay(go.Point.stringify),GO(go.TextBlock,{font:"bold 22px Segoe UI, sans-serif",stroke:"black",margin:5},{name:"LTEXT"},new go.Binding("text","ltext")),GO(go.Shape,{name:"SHAPE",fill:"#2E8DEF",strokeWidth:0,portId:"",fromSpot:go.Spot.RightSide,toSpot:go.Spot.LeftSide,height:10,width:20},new go.Binding("fill")),GO(go.Panel,"Auto",GO(go.Shape,"Rectangle",{fill:null,stroke:null,margin:3},new go.Binding("fill","isSelected",function(e){return e?"#FFC106":null}).ofObject("")),GO(go.TextBlock,{margin:3},new go.Binding("text","text"),new go.Binding("stroke","isSelected",function(e){return e?"#FFF":"#333"}).ofObject(""))));var e=GO(go.Adornment,"Link",GO(go.Shape,{isPanelMain:!0,fill:null,stroke:"rgba(0, 0, 255, 0.3)",strokeWidth:0}));myDiagram.linkTemplate=GO(go.Link,go.Link.Bezier,{zOrder:1,selectionAdornmentTemplate:e,layerName:"Background",fromEndSegmentLength:150,toEndSegmentLength:150,adjusting:go.Link.End},GO(go.Shape,{strokeWidth:4,stroke:"rgba(173, 173, 173, 0.25)"},new go.Binding("strokeWidth","money",function(e){return 1e6<e?8:1e5<e?6:1e5<e?4:2}),new go.Binding("stroke","money",function(e){return 1e6<e?"red":1e5<e?"orange":1e5<e?"green":"#ccc"})),GO(go.TextBlock,{text:"",font:"16px helvetica, bold Arial, sans-serif"},new go.Binding("text")),GO(go.Shape,{name:"link_arrow",toArrow:"standard",stroke:"#BDBDBD",fill:"#BDBDBD"},new go.Binding("fill","d_fill"),new go.Binding("stroke","d_stroke")))}animation.easing=go.Animation.EaseLinear;