"use strict";function SankeyLayout(){go.LayeredDigraphLayout.call(this)}function getAutoHeightForNode(e){for(var n=0,o=e.findLinksInto();o.next();)n+=o.value.computeThickness();for(var t=0,o=e.findLinksOutOf();o.next();)t+=o.value.computeThickness();e=Math.max(n,t);return e<10&&(e=10),e}go.Diagram.inherit(SankeyLayout,go.LayeredDigraphLayout),SankeyLayout.prototype.makeNetwork=function(e){var i=go.LayeredDigraphLayout.prototype.makeNetwork.call(this,e);return this.diagram.nodes.each(function(e){var n=getAutoHeightForNode(e),o=e.findObject("SHAPE");o&&(o.height=n);var t=e.findObject("TEXT"),o=e.findObject("LTEXT"),n="bold "+Math.max(12,Math.round(n/8))+"pt Segoe UI, sans-serif";t&&(t.font=n),o&&(o.font=n);n=i.findVertex(e);null!==n&&(e.ensureBounds(),e=e.actualBounds,n.width=e.width,n.height=e.height,n.focusY=n.height/2)}),i},SankeyLayout.prototype.nodeMinColumnSpace=function(e,n){if(null!==e.node)return go.LayeredDigraphLayout.prototype.nodeMinColumnSpace.call(this,e,n);if(1<=e.edgesCount){for(var o=1,t=e.edges;t.next();){var i=t.value;if(null!=i.link){i=i.link.computeThickness();o<i&&(o=i);break}}return Math.max(2,Math.ceil(o/this.columnSpacing))}return 2},SankeyLayout.prototype.nodeMinLayerSpace=function(e,n){return null===e.node?100:go.LayeredDigraphLayout.prototype.nodeMinLayerSpace.call(this,e,n)},SankeyLayout.prototype.assignLayers=function(){go.LayeredDigraphLayout.prototype.assignLayers.call(this);for(var e=this.maxLayer,n=this.network.vertexes.iterator;n.next();){var o=n.value;o.node;0==o.destinationVertexes.count&&(o.layer=0),0==o.sourceVertexes.count&&(o.layer=e)}},SankeyLayout.prototype.commitLayout=function(){go.LayeredDigraphLayout.prototype.commitLayout.call(this);for(var e=this.network.edges.iterator;e.next();){var n=e.value.link;n&&n.curve===go.Link.Bezier&&n.invalidateRoute()}};var animation=new go.Animation;function sankey_layout(){graph_layout_type=1,myDiagram.div=null,myDiagram=GO(go.Diagram,Diagram_name,{initialAutoScale:go.Diagram.Uniform,"animationManager.isEnabled":!1,ModelChanged:function(){}}),initOverview(),myDiagram.nodeTemplateMap.add("",GO(go.Node,"Vertical",new go.Binding("visible"),new go.Binding("location","loc",function(e,n){return 1==n.data.isLocking?(n.isLayoutPositioned=!1,n.part.movable=!1,new go.Point(n.data.lock.x,n.data.lock.y)):new go.Point.parse(e)}).makeTwoWay(go.Point.stringify),{visible:!0,zOrder:2,layerName:"Foreground",mouseEnter:function(e,n){animation=null,(animation=new go.Animation).easing=go.Animation.EaseLinear,myDiagram.links.each(function(e){e.fromNode.key!=n.key&&e.toNode.key!=n.key||(e.findObject("PIPE").opacity=1,animation.add(e.findObject("PIPE"),"strokeDashOffset",20,0))}),animation.runCount=1/0,animation.start()},mouseLeave:function(e,n){myDiagram.links.each(function(e){e.fromNode.key!=n.key&&e.toNode.key!=n.key||(e.findObject("PIPE").opacity=0)}),animation.stop()},click:function(){},doubleClick:function(){send_newGraph("属性")}},new go.Binding("visible"),new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),GO(go.Shape,"Ellipse",{name:"node_shape",stroke:"#006ADF",fill:"#006ADF",width:60,cursor:"pointer",height:60,portId:"",strokeWidth:5},{toolTip:tooltipTemplate},new go.Binding("width"),new go.Binding("height")),GO(go.Picture,{name:"icon_enetity",source:"./img/account.svg",margin:new go.Margin(-40,0,0,0),opacity:1},new go.Binding("source","icon",geoFunc),new go.Binding("width","width",function(e){return.6*e}),new go.Binding("height","height",function(e){return.5*e}),new go.Binding("margin","height",function(e){return new go.Margin(.78*-e,0,0,0)})),GO(go.Panel,"Auto",{margin:12},new go.Binding("margin","width",function(e){return 12*e/60*1.2}),new go.Binding("opacity","text",function(e){return console.log(e.length),0!=e.length}),GO(go.Shape,"Rectangle",{fill:null,stroke:null,margin:new go.Margin(5,0,0,0)},new go.Binding("fill","isSelected",function(e){return e?"#FFC106":null}).ofObject("")),GO(go.TextBlock,{margin:6,font:"bold 12pt Segoe UI, sans-serif",stroke:"#333"},new go.Binding("text","text",function(e){return e}),new go.Binding("stroke","isSelected",function(e){return e?"#fff":"#333"}).ofObject(""))),{selectionAdornmentTemplate:GO(go.Adornment,"Vertical",GO(go.Shape,"RoundedRectangle",{width:100,height:130,fill:null,stroke:null,strokeWidth:5,margin:new go.Margin(0,0,0,0)}),GO(go.Placeholder))},{selectionAdorned:!1})),myDiagram.nodeTemplateMap.add("square",GO(go.Node,"Auto",GO(go.Shape,"RoundedRectangle",{width:120,height:64,fill:"#fff",stroke:"#D55500",strokeWidth:2},new go.Binding("d_fill"),new go.Binding("d_stroke")),GO(go.TextBlock,{name:"icon_label",opacity:1,margin:8,maxSize:new go.Size(200,NaN),wrap:go.TextBlock.WrapFit,stroke:"#D55500",editable:!0},new go.Binding("text").makeTwoWay()),new go.Binding("stroke","d_stroke")));GO(go.Adornment,"Link",GO(go.Shape,{isPanelMain:!0,fill:null,stroke:"blue",strokeWidth:3}));myDiagram.linkTemplate=GO(go.Link,{zOrder:1,fromEndSegmentLength:150,toEndSegmentLength:150,adjusting:go.Link.End},{doubleClick:function(){send_newGraph("属性")}},{},new go.Binding("points").makeTwoWay(),GO(go.Shape,{opacity:1,isPanelMain:!0,stroke:"#BDBDBD",strokeWidth:1,fill:"#BDBDBD"},new go.Binding("strokeWidth","money",function(e){return 1e6<e?4:1e5<e?3:1e5<e?2:1}),new go.Binding("stroke","money",function(e){return 1e6<e?"red":1e5<e?"orange":1e5<e?"green":"#ccc"}),new go.Binding("stroke","patt",function(e){return""===e?"":"transparent"}),new go.Binding("pathPattern","patt",convertPathPatternToShape)),GO(go.Shape,{isPanelMain:!0,stroke:"white",strokeWidth:3,name:"PIPE",strokeDashArray:[10,10],opacity:0}),GO(go.TextBlock,"2/3",{segmentIndex:NaN,segmentFraction:.5,font:"bold 12pt Segoe UI, sans-serif",stroke:"#333"},new go.Binding("text","text",function(e){return e.replace(/(\r\n)|(\n)/g,"  ")})),GO(go.Shape,{name:"link_arrow",toArrow:"standard",stroke:"#BDBDBD",fill:"#BDBDBD"},new go.Binding("strokeWidth","money",function(e){return 1e6<e?4:1e5<e?3:1e5<e?2:1}),new go.Binding("stroke","money",function(e){return 1e6<e?"red":1e5<e?"orange":1e5<e?"green":"#ccc"})))}animation.easing=go.Animation.EaseLinear;